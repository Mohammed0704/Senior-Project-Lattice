<!DOCTYPE html>
<html>
<link rel='stylesheet' href='/static_files/main.css' />
<link rel='stylesheet' href='/static_files/portal_data_source_connections.css' />
 

<center>
  <head>
      <title>Data Source Connections Portal</title>
      <b>
          <h1 style="margin-bottom: 1.5%;">Data Source Connections Portal</h1>
      </b>
  </head>
  
  <body>
    <div id="outer-content-box">
      <p id="title">Create New Connection</p>
      <div id="inner-content-box" style="border:1px solid black;">
        <p id="result"></p>
        <form id="form-create-connection" method="post">
          <div class="formSet">
            <label for="name" class="formLabel">Name</label>
            <input type="text" id="name" name="name" value="" class="formInput">
          </div>
          <div class="formSet">
            <label for="data_source" class="formLabel">Data Source Type</label>
            <select id="data-source" name="data_source" value="" class="formInput">
              {% for databaseType in databaseTypes %}
                <option value="{{ databaseType }}">{{ databaseType }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="formSet">
            <label for="address" class="formLabel">Address</label>
            <input type="text" id="address" name="address" value="" class="formInput">
          </div>
          <div class="formSet">
            <label for="port" class="formLabel">Port</label>
            <input type="number" id="port" name="port" value="" class="formInput" min="0" max="65535">
          </div>
          <div class="formSet">
            <label for="username" class="formLabel">Username</label>
            <input type="text" id="username" name="username" value="" class="formInput">
          </div>
          <div class="formSet">
            <label for="password" class="formLabel">Password</label>
            <input type="password" id="password" name="password" value="" class="formInput">
          </div>
        </form>
      </div>
      <p></p>
      <div style="display: flex">
        <a href="/connections">
          <button class="button button3">Back</button>
        </a>
        <input class="button button3" id="create-button" type="submit" value="Create New">
      </div>
    </div>
  </body>
</center>

<script src="/static_files/jquery-3.1.1.js"></script>

<script>
  const form = document.querySelector('#form-create-connection');
  const createButton = document.querySelector('#create-button');
  const result = document.querySelector('#result');
  
 
  createButton.addEventListener('click', function(event) {
    const portInput = document.querySelector('#port');
    if (portInput.value < 0 || portInput.value > 65535) {
      event.preventDefault();
      result.innerText = 'Please enter a valid port number between 0 and 65535.';
      result.style.color = 'red';
    } else {
      const name = form.elements.name.value;
      const data_source = form.elements.data_source.value;
      const address = form.elements.address.value;
      const port = form.elements.port.value;
      const username = form.elements.username.value;
      const password = form.elements.password.value;
      if (name.includes(' ') || name == "") {
        result.innerHTML = `<p id="error-message">Cannot have spaces in the connection name</p>`;
        return;
      }
      const connection_dict = JSON.stringify({
        'name': name,
        'data_source': data_source,
        'address': address,
        'port': port,
        'username': username,
        'password': password
      });
  
      fetch('/connections/create', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: connection_dict
      })
      .then(response => response.json())
      .then(data => {
        console.log(data)
        if (data.success) {
          result.innerHTML = `<p id="success-message">Connection "${name}" was added</p>`;
        } else {
          result.innerHTML = `<p id="error-message">Connection "${name}" already exists</p>`;
        }
      });
    } 
  });
 </script>

</html>