<!DOCTYPE html>
<html>
<link rel='stylesheet' href='/static_files/main.css' />
<link rel='stylesheet' href='/static_files/portal_graph_loader.css' />
 

<center>
  <head>
      <title>Graph Loader Portal</title>
      <b>
          <h1 style="margin-bottom: 1.5%;">Graph Loader Portal</h1>
      </b>
  </head>
  
  <body>
    <div id="outer-content-box">
      <p id="title"><strong>Note: </strong>Once 'Load Data' is clicked, all previous data in Neo4j will be cleared</p>
      <button id="load-button" class="button button1">Load Data</button>
      <p id="execution-container-text" style="font-size: 24px;"></p>
    </div>
</body>
</center>


<script src="/static_files/jquery-3.1.1.js"></script>

<script>
function execute(executionIndex) {
  const executionContainerText = document.querySelector('#execution-container-text');
  const loadButton = document.getElementById("load-button");

  console.log("fetching!");
  fetch('/loader/load', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: executionIndex
  })
  .then(response => response.json())
  .then(data => {
    console.log(data);
    if (data.returnMessage == "END_OF_EXECUTION") {
      console.log("end of execution");
      loadButton.disabled = false;
      loadButton.classList.remove("spinner"); // remove "spinner" class from button
      loadButton.innerHTML = "Load Data"; // restore button text
    } else {
      console.log("next execution");
      executionContainerText.innerHTML = executionContainerText.innerHTML + "<br></br>" + data.returnMessage
      tempExecutionIndex = executionIndex + 1;
      execute(tempExecutionIndex); //recursive call
    }
  });
}

$("#load-button").click(function(event) {
  const loadButton = document.getElementById("load-button");
  const executionContainerText = document.getElementById("execution-container-text");

  loadButton.disabled = true;
  loadButton.innerHTML = "Loading...";
  loadButton.classList.add("spinner"); // add "spinner" class to button

  executionContainerText.innerHTML = "";

  var executionIndex = 0;
  execute(executionIndex);
});

</script>

</html>
